{"version":3,"file":"preoccupyjs.es5.js","sources":["../src/transports/abstract.ts","../src/transports/local.ts","../src/actions.ts","../src/client.ts","../src/dom.ts","../src/host.ts","../src/preoccupyjs.ts"],"sourcesContent":["import { PreoccupyAction } from \"../actions\";\nexport enum TransportEvents {\n    connect,\n    disconnect,\n    action\n}\n\nexport type Listener = (event: TransportEvent) => void;\n\nexport interface TransportEvent {\n    type: TransportEvents;\n    detail: any;\n}\n\nexport interface AbstractTransport {\n    on(type: TransportEvents, callback: Listener): void;\n    publish(action: PreoccupyAction): void;\n}\n\nexport class Message {\n    public hash: string;\n\n    constructor(public type: string, public data: object, hash?: string) {\n        this.hash = hash || Math.random() * 10e6 + '';\n    }\n\n    public serialize(): string {\n        return JSON.stringify(this.data);\n    }\n\n    static parse(src: string): Message {\n        const [_prefix, type, hash, dataSrc] =  src.split('|');\n        return new Message(type, JSON.parse(dataSrc), hash);\n    }\n};","import { AbstractTransport, TransportEvents, TransportEvent, Listener, Message } from './abstract';\nimport { PreoccupyAction } from '../actions';\n\nexport class LocalTransport implements AbstractTransport {\n\n    private connected: boolean = false;\n    private listeners: { [prop: string]: Listener[] } = {};\n    private publishedMessages: Message[] = [];\n    private storage: Storage = localStorage;\n\n    constructor(private preifx: string = 'prefix', private stackSize: number = 10) {}\n\n    public handshake() {\n        if (this.connected) {\n            this.trigger(TransportEvents.connect);\n        } else {\n            this.connect();\n        }\n    }\n\n    public on(eventName: TransportEvents, callback: Listener): void {\n        if (!this.listeners[eventName]) {\n            this.listeners[eventName] = [];\n        }\n        this.listeners[eventName].push(callback);\n    };\n\n    public publish(action: PreoccupyAction): void {\n        const message = new Message('action', action);\n\n        this.publishedMessages.push(message);\n        this.storage.setItem(`${this.preifx}|${message.type}|${message.hash}`, message.serialize());\n\n        if (this.publishedMessages.length > this.stackSize) {\n            const messageToDelete = this.publishedMessages.shift();\n            if (messageToDelete != null) {\n                this.storage.removeItem(`${this.preifx}|${messageToDelete.type}|${messageToDelete.hash}`);\n            }\n        }\n    };\n\n    private connect() {\n        window.addEventListener('storage', (event) => this.onStorageMessage(event));\n        this.connected = true;\n        this.trigger(TransportEvents.connect);\n    }\n\n    private onStorageMessage({key, newValue}: StorageEvent) {\n        if (key && newValue && key.startsWith(this.preifx)) {\n            const message = Message.parse(key + '|' + newValue);\n\n            if (this.isExternalMessage(message)) {\n                this.trigger(TransportEvents.action, message);\n            }\n        }\n    }\n\n    private trigger(type: TransportEvents, detail?: any) {\n        if (Array.isArray(this.listeners[type])) {\n            this.listeners[type].forEach((callback) => callback({\n                type,\n                detail\n            }));\n        };\n    }\n\n    private isExternalMessage(message: Message): boolean {\n        return this.publishedMessages.find((ownMessage) => ownMessage.hash === message.hash) == null;\n    }\n}\n","export enum ActionsName {\n    MOVE_TO = '[Action] Move To',\n    CLICK_TO = '[Action] Click To',\n    DBL_CLICK_TO = '[Action] Double Click To',\n    KEYPRESS = '[Action] Keypress',\n    SCROLL_BY = '[Action] Scroll By'\n}\n\nexport interface PreoccupyAction {\n    type: string;\n    payload?: any;\n}\n\nexport class MoveToAction implements PreoccupyAction {\n    public type:string = ActionsName.MOVE_TO;\n    constructor(public payload: {x: number, y: number}) {};\n}\n\nexport class ClickToAction implements PreoccupyAction {\n    public type:string = ActionsName.CLICK_TO;\n    constructor(public payload: {x: number, y: number}) {};\n}\n\nexport class KeypressAction implements PreoccupyAction {\n    public type:string = ActionsName.KEYPRESS;\n    constructor(public payload: {which: number}) {};\n}\n\nexport class ScrollByAction implements PreoccupyAction {\n    public type:string = ActionsName.SCROLL_BY;\n    constructor(public payload: {x: number, y: number, deltaX: number, deltaY: number}) {};\n}\n\nexport class DblClickToAction implements PreoccupyAction {\n    public type:string = ActionsName.DBL_CLICK_TO;\n    constructor(public payload: {x: number, y: number}) {};\n}\n\nexport type ActionUnion = MoveToAction |\n    ClickToAction |\n    DblClickToAction |\n    KeypressAction |\n    ScrollByAction;","import { AbstractTransport, TransportEvents, Message } from './transports';\nimport { ActionUnion, ActionsName, MoveToAction, ClickToAction, KeypressAction, ScrollByAction, DblClickToAction } from './actions';\nimport { DomController } from './dom';\n\nexport class Client {\n    constructor(\n        transport: AbstractTransport,\n        private dom: DomController\n    ) {\n        transport.on(TransportEvents.connect, (event) => {\n            console.log('Clinet', event);\n            this.calibrate();\n            this.dom.init();\n        });\n\n        transport.on(TransportEvents.action, (event) => {\n            const message: Message = event.detail;\n\n            console.log('Clinet message', message.data)\n            this.perform(message.data as ActionUnion); // TODO: Transport for Actions?\n        });\n    }\n\n    public calibrate() {\n        // to implement\n    }\n\n    public perform(action: ActionUnion) {\n        switch (action.type) {\n            case ActionsName.MOVE_TO:\n                this.dom.moveCursorTo((<MoveToAction>action).payload);\n                break;\n\n            case ActionsName.CLICK_TO:\n                this.dom.clickTo((<ClickToAction>action).payload);\n                break;\n\n            case ActionsName.DBL_CLICK_TO:\n                this.dom.dblClickTo((<DblClickToAction>action).payload);\n                break;\n\n            case ActionsName.KEYPRESS:\n                this.dom.keypress((<KeypressAction>action).payload);\n                break;\n\n            case ActionsName.SCROLL_BY:\n                this.dom.scroll((<ScrollByAction>action).payload);\n                break;\n\n            default:\n                break;\n        }\n    }\n\n}","import { Coordinates } from \"./host\";\n\nconst CURSOR = 1;\n\nexport class DomController {\n\n    private cursorEl: HTMLElement = document.createElement('div');\n\n    constructor(private el: Element) {}\n\n    public init() {\n        this.createCursorEl();\n        this.moveCursorTo({x: 0, y: 0});\n    }\n\n    public moveCursorTo(coordinates: Coordinates) {\n        const { x, y } = this.getAbsoluteCoordinates(coordinates);\n        this.cursorEl.style.top = `${y}px`;\n        this.cursorEl.style.left = `${x}px`;\n    }\n\n    public clickTo(coordinates: Coordinates) {\n        const el = <HTMLElement>this.getElementFromPoint(this.getAbsoluteCoordinates(coordinates));\n\n        switch (el.tagName.toLowerCase()) {\n            case 'textarea':\n            case 'input':\n                this.setFocus(<HTMLTextAreaElement>el);\n            default:\n                this.fireEvent('mousedown', el);\n                this.fireEvent('mouseup', el);\n                this.fireEvent('click', el);\n                break;\n        }\n\n    }\n\n    public dblClickTo(coordinates: Coordinates) {\n        const el = <HTMLElement>this.getElementFromPoint(this.getAbsoluteCoordinates(coordinates));\n        this.fireEvent('dblclick', el);\n    }\n\n    public keypress({which}: {which: number}) {\n        const el = document.activeElement;\n        if (el == null) {\n            return;\n        }\n\n        switch (el.tagName.toLowerCase()) {\n            case 'textarea':\n            case 'input':\n                this.fireEvent('keydown', <HTMLTextAreaElement>el);\n                this.fireEvent('keypress', <HTMLTextAreaElement>el);\n                (<HTMLTextAreaElement>el).value += String.fromCharCode(which);\n                this.fireEvent('input', <HTMLTextAreaElement>el);\n                this.fireEvent('keyup', <HTMLTextAreaElement>el);\n            default:\n                break;\n        }\n    }\n\n    public scroll({x, y, deltaX, deltaY}: {x: number, y: number, deltaX: number, deltaY: number}) {\n        let initialEl = <HTMLElement>this.getElementFromPoint(this.getAbsoluteCoordinates({x, y}));\n        let scrollableEl: HTMLElement | undefined;\n        let el = initialEl;\n\n        while(el.parentElement) {\n            if (this.isScrollable(el)) {\n                scrollableEl = el;\n                break;\n            }\n\n            el = el.parentElement;\n        }\n\n        if (scrollableEl) {\n            scrollableEl.scrollBy({\n                left: deltaX,\n                top: deltaY\n            });\n        }\n\n        this.fireEvent('wheel', el);\n        this.fireEvent('scroll', el);\n    }\n\n    private getAbsoluteCoordinates({x, y}: Coordinates): Coordinates {\n        const { clientHeight, clientWidth } = this.el as HTMLBodyElement;\n\n        return {\n            x: x * clientWidth,\n            y: y * clientHeight\n        };\n    }\n\n    private css(el: HTMLElement, styles: Partial<CSSStyleDeclaration>) {\n        for (const [prop, value] of Object.entries(styles)) {\n            el.style.setProperty(prop, value);\n        }\n    }\n\n    private getElementFromPoint({x, y}: Coordinates) {\n        return document.elementFromPoint(x - CURSOR, y - CURSOR);\n    }\n\n    private setFocus(el: HTMLTextAreaElement | HTMLInputElement) {\n        el.focus();\n        el.select();\n    }\n\n    private fireEvent(type: string, el: HTMLElement): boolean {\n        let event: Event;\n\n        switch (type) {\n            case 'click':\n            case 'dblclick':\n            case 'mousedown':\n            case 'mouseup':\n                event = new MouseEvent(type, {\n                    bubbles: true,\n                    cancelable: true\n                });\n                break;\n            default:\n                event = new Event(type, {\n                    bubbles: true,\n                    cancelable: true\n                });\n                break;\n        }\n\n        console.log('emited', event);\n        return el.dispatchEvent(event);\n    }\n\n    private isScrollable(el: HTMLElement) {\n        return el.scrollWidth > el.clientWidth || el.scrollHeight > el.clientHeight;\n    }\n\n    private createCursorEl() {\n        this.css(this.cursorEl, <Partial<CSSStyleDeclaration>>{\n            'z-index': '100500',\n            'position': 'absolute',\n            'width': '30px',\n            'height': '30px',\n            'display': 'inline-block',\n            'background': `url('data:image/png;base64,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')`,\n        });\n\n        const bodyEl = this.el.querySelector('body');\n        if (bodyEl) {\n            bodyEl.appendChild(this.cursorEl);\n        } else {\n            this.el.appendChild(this.cursorEl);\n        }\n    }\n\n}","import { AbstractTransport, TransportEvents } from './transports';\nimport { MoveToAction, ClickToAction, KeypressAction, ScrollByAction, DblClickToAction } from './actions';\n\nexport interface Coordinates {\n    x: number;\n    y: number;\n}\n\nexport class Host {\n    constructor(private transport: AbstractTransport, private el: HTMLElement) {\n        transport.on(TransportEvents.connect, (event) => {\n            console.log('HOST', event);\n        });\n\n        this.initEvents();\n    }\n\n    public moveCursorTo(event: MouseEvent) {\n        const coordinates = this.getRelativeCoordinate(event);\n        this.transport.publish(new MoveToAction(coordinates));\n    }\n\n    public clickTo(event: MouseEvent) {\n        const coordinates = this.getRelativeCoordinate(event);\n        this.transport.publish(new ClickToAction(coordinates));\n    }\n\n    public dblClickTo(event: MouseEvent) {\n        const coordinates = this.getRelativeCoordinate(event);\n        this.transport.publish(new DblClickToAction(coordinates));\n    }\n\n    public keypress(which: number) {\n        this.transport.publish(new KeypressAction({which}));\n    }\n\n    public wheel(event: WheelEvent) {\n        const coordinates = this.getRelativeCoordinate(event);\n        this.transport.publish(new ScrollByAction({\n            ...coordinates,\n            deltaX: event.deltaX,\n            deltaY: event.deltaY\n        }));\n    }\n\n    private initEvents() {\n        this.el.addEventListener('mousemove', (event) => {\n            this.moveCursorTo(event);\n        });\n\n        this.el.addEventListener('click', (event) => {\n            this.clickTo(event);\n        });\n\n        this.el.addEventListener('keypress', (event) => {\n            this.keypress(event.which);\n        });\n\n        this.el.addEventListener('wheel', (event) => {\n            this.wheel(event);\n        });\n\n        this.el.addEventListener('dblclick', (event) => {\n            this.dblClickTo(event);\n        })\n    }\n\n    private getRelativeCoordinate(event: MouseEvent): {x: number, y: number} {\n        const { offsetX, offsetY } = event;\n        const { clientHeight, clientWidth } = <HTMLDivElement>event.target;\n\n        return {\n            x: offsetX / clientWidth,\n            y: offsetY / clientHeight\n        };\n    }\n}\n","import { Client } from './client';\nimport { LocalTransport } from './transports/local';\nimport { DomController } from './dom';\nimport { Host } from './host';\n\nexport * from './client';\nexport * from './host';\n\nconst transport = new LocalTransport();\n\nexport function start(el: HTMLElement): Client {\n  const client = new Client(transport, new DomController(el));\n  transport.handshake();\n  return client;\n\n}\n\nexport function connect(el: HTMLElement): Host {\n  const host = new Host(transport, el);\n  transport.handshake();\n  return host;\n}"],"names":[],"mappings":"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"}